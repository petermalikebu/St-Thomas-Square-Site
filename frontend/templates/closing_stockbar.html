<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Closing Stock Management</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background-color: #f4f4f4;
            display: flex;
        }
        /* Sidebar styles */
        .sidebar {
            height: 100vh;
            width: 200px;
            background-color: #007bff;
            padding-top: 20px;
            position: fixed;
            left: 0;
            top: 0;
        }
        .sidebar a {
            display: block;
            color: white;
            padding: 15px;
            text-decoration: none;
            font-weight: bold;
            border-bottom: 1px solid #ddd;
        }
        .sidebar a:hover {
            background-color: #0056b3;
        }

        /* Container for content */
        .container {
            margin-left: 220px;
            max-width: 600px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            flex: 1;
        }
        input, button {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        button {
            background-color: #28a745;
            color: white;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #218838;
        }
        table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }
        th {
            background-color: #007bff;
            color: white;
        }
        .total-container {
            margin-top: 10px;
            font-size: 18px;
            font-weight: bold;
            text-align: right;
        }
    </style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
    <a href="opening_stockbar.html">Opening Stock</a>
    <a href="closing_stockbar.html" class="active">Closing Stockbar</a>
</div>

<!-- Main Content -->
<div class="container">
    <h2>Closing Stock</h2>
    <table id="closingStockTable">
        <thead>
            <tr>
                <th>Item Name</th>
                <th>Opening Quantity</th>
                <th>Sold Quantity</th>
                <th>Remaining Quantity</th>
                <th>Sold Value (MWK)</th>
            </tr>
        </thead>
        <tbody>
            <!-- Rows will be dynamically populated -->
        </tbody>
    </table>

    <div class="total-container">
        Total Sales Value: MWK <span id="totalSalesValue">0.00</span>
    </div>

    <h3>Cash Collection</h3>
    <label for="totalCash">Total Cash Collected (MWK):</label>
    <input type="number" id="totalCash" step="0.01">
    <button type="button" onclick="calculateDifference()">Check Difference</button>

    <div class="total-container">
        Cash Difference: MWK <span id="cashDifference">0.00</span>
    </div>
</div>

<script>
    let totalSalesValue = 0;
    let stockData = JSON.parse(localStorage.getItem('openingStock')) || [];

    // Function to populate the closing stock table
    function loadClosingStock() {
        let closingStockTable = document.getElementById("closingStockTable").getElementsByTagName("tbody")[0];
        closingStockTable.innerHTML = '';

        stockData.forEach((stock, index) => {
            let row = closingStockTable.insertRow();
            row.innerHTML = `
                <td>${stock.item}</td>
                <td>${stock.quantity}</td>
                <td><input type="number" id="sold-${index}" value="0" min="0" max="${stock.quantity}" oninput="updateStock(${index})"></td>
                <td id="remaining-${index}">${stock.quantity}</td>
                <td id="soldValue-${index}">MWK 0.00</td>
            `;
        });
    }

    // Function to update stock quantity and calculate sold value
    function updateStock(index) {
        let soldQty = parseInt(document.getElementById(`sold-${index}`).value) || 0;
        if (soldQty > stockData[index].quantity) {
            alert("Sold quantity cannot be greater than stock quantity.");
            document.getElementById(`sold-${index}`).value = stockData[index].sold || 0;
            return;
        }

        stockData[index].sold = soldQty;
        let remaining = stockData[index].quantity - soldQty;
        let soldValue = soldQty * stockData[index].price;

        document.getElementById(`remaining-${index}`).innerText = remaining;
        document.getElementById(`soldValue-${index}`).innerText = `MWK ${soldValue.toFixed(2)}`;

        totalSalesValue = stockData.reduce((sum, stock) => sum + ((stock.sold || 0) * stock.price), 0);
        document.getElementById("totalSalesValue").innerText = totalSalesValue.toFixed(2);
    }

    // Function to calculate and show the cash difference
    function calculateDifference() {
        let totalCash = parseFloat(document.getElementById("totalCash").value) || 0;
        let difference = totalCash - totalSalesValue;

        document.getElementById("cashDifference").innerText = difference.toFixed(2);
    }

    // Load closing stock data when the page loads
    window.onload = loadClosingStock;
</script>

</body>
</html>
